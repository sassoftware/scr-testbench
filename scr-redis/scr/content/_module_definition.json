{
  "scope": "PUBLIC",
  "source": "package sample_redis  / inline;\n\n    dcl package GlobalContext context();\n        dcl package Container container;\n        dcl package SystemContext \"_sidSysCtxt\";\n        dcl package rediscli \"_sid_rdsp\";\n        dcl package logger logr_perf('App.tk.SID.Perf');\n        dcl double timer_start;\n        dcl double elapsed_time;\n        dcl double total_timer_start;\n        dcl double total_elapsed_time;\n        dcl package logger logr_error('App.tk.SID.Error');\n\n    dcl package \"sampleu45redis_car_lookup_1_0\" \"sampleu45redis_car_lookup_1_0_hdl\"();\n\n     method initGlobalContext();\n            dcl package SystemContext sc();\n            dcl package Container c1();\n            c1.sysCtxt = sc;\n            context.init();\n            context.add('System', c1);\n            _sidSysCtxt = sc;\n         end;\n         method initRedisDatagrid();\n             \"sampleu45redis_car_lookup_1_0_hdl\".initRdsp();\n     end;\n\n     method init();\n             initGlobalContext();\n             initRedisDatagrid();\n\n     end;\n\n    method execute_internal(\n       in_out varchar \"name\"\n      ,in_out double \"number\"\n      ,in_out varchar \"origin\"\n\n      ,in_out integer \"_filter_\"\n\n    );\n        dcl integer dg_filter_;\n\n       dcl integer _sidLogStatus;\n           dcl varchar(3000) _sidLogErrorMsg;\n\n        context.find('System', container);\n            \"_sidSysCtxt\" = container.sysCtxt;\n            if null(\"_sid_rdsp\") then do;\n                \"_sid_rdsp\" = \"_sidSysCtxt\".initRedisCli();\n            end;\n\ntotal_timer_start = datetime();\n\n        timer_start = datetime();\n        \"sampleu45redis_car_lookup_1_0_hdl\".execute(\"name\", \"number\", \"origin\", \"_sidSysCtxt\");\n\n        elapsed_time = datetime() - timer_start;\n        logr_perf.log( 'd', 'Package Name: sample_redis, Node Name: car_lookup, Node ID: e9421c56-214d-4574-9bc3-d88efc17cb5c, NODE DURATION: ' .. elapsed_time);\n\n        \"end\":/*label for decision node link to flow end*/\n\ntotal_elapsed_time = datetime() - total_timer_start;\nlogr_perf.log( 'd', 'Package Name: sample_redis, TOTAL DURATION: ' .. total_elapsed_time);\n\n     end;\n\n    method execute(\n       varchar(32) \"name_\"\n      ,in_out varchar \"name\"\n      ,in_out double \"number\"\n      ,in_out varchar \"origin\"\n);\n\n      dcl integer _filter_;\n\n      \"name\" = \"name_\";\n\n      execute_internal(\n          \"name\"\n         ,\"number\"\n         ,\"origin\"\n      ,\"_filter_\"\n      );\n\n    end;\n\n      endpackage;",
  "submodules": [
    {
      "name": "SystemContext",
      "source": "package SystemContext /overwrite = yes;\n    dcl int rc;\n    dcl package rediscli _sid_rdsp;\n    method initRediscli() returns package rediscli;\n        if null(_sid_rdsp) then do;\n            _sid_rdsp = _new_ rediscli();\n                                rc = _sid_rdsp.connect('sid-lists');\n        end;\n        return _sid_rdsp;\n    end;\nendpackage;",
      "language": "DS2"
    },
    {
      "name": "Container",
      "source": "package Container / overwrite = yes;\n    dcl package SystemContext sysCtxt;\nendpackage;",
      "language": "DS2"
    },
    {
      "name": "GlobalContext",
      "source": "package GlobalContext / overwrite = yes;\n\n    dcl varchar(1024) ctxtKey;\n    dcl package Container ctxtValue;\n    dcl package hash context();\n\n    method init();\n        context.definekey('ctxtKey');\n        context.definedata('ctxtValue');\n        context.defineDone();\n    end;\n\n    method add(varchar(1024) key, package Container value);\n        ctxtKey = key;\n        ctxtValue = value;\n        context.ref();\n    end;\n\n    method getItemCount(in_out integer count);\n        count = context.num_items;\n    end;\n\n    method find(varchar(1024) key, in_out package Container value);\n        ctxtKey = key;\n        context.find();\n        value = ctxtValue;\n    end;\n\nendpackage;",
      "language": "DS2"
    },
    {
      "name": "sampleu45redis_car_lookup_1_0",
      "source": "  package \"sampleu45redis_car_lookup_1_0\"  / inline;\n\ndcl package rediscli _sid_rdsp;\n\n    dcl double _redis_datagrid_extended;\n\n      dcl package logger _logger('App.SASDCM');\n      dcl package logger logr_variableTrace('App.TableServices.DS2.Runtime.TraceVariables');\n\n            method setruleFiredBasePosition(integer newBasePosition); end;\n            method setDecisionNodeID(varchar newDecisonNodeID); end;\n            method enableRuleFiredRecording(); end;\n            method disableRuleFiredRecording(); end;\n            method initRuleFireHashes(); end;\n            method getRuleFiredFlagCount() returns integer;  return 0; end;\n            method recordRuleFired(\n              in_out char    ruleFiredFlags,\n              in_out integer rulesFiredForRecordCount,\n              char(36)       this_rule_id);\n            end;\n\n        method initRdsp();\n    end;\n\nmethod formatListNumericKey(double x) returns varchar;\n    if missing(x) then do;\n        return '';\n    end;\n    else do;\n        return putn(x, 'BEST24.-L');\n    end;\nend;\n\n    method execute( in_out varchar \"name\",in_out double \"number\",in_out varchar \"origin\", in_out package SystemContext \"globalSystemContext\");\n\n      dcl double rc;\n      dcl double rc_query;\n      dcl varchar(100000) _redis_key;\n      dcl varchar(10) _row_state;\n      dcl double _row_expiry;\n      dcl varchar(12) _row_expiry_string;\n      dcl varchar(36) \"number_string\";\n\n\"_sid_rdsp\" = \"globalSystemContext\"._sid_rdsp;\n\n         _redis_key = catt('SAS|0|0|LIST|cars|1', '|', \"name\");\nrc = _sid_rdsp.HGET(_redis_key, '_ldMetadata_state', \"_row_state\");\nif (rc eq 0 ) then do;\nif (_row_state eq 'deployed') then do;\nrc = _sid_rdsp.HGET(_redis_key, '_ldMetadata_expiry', \"_row_expiry_string\");\nif (rc eq 0 ) then do;\n_row_expiry=inputn(\"_row_expiry_string\", '24.8') + 315619200;\nif missing(_row_expiry)=1 or datetime() le _row_expiry then do;\nrc = _sid_rdsp.HGET(_redis_key, 'number', \"number_string\");\nnumber=inputn(\"number_string\", '24.8');\nrc = _sid_rdsp.HGET(_redis_key, 'origin', \"origin\");\nend;\nelse do;number = .;\norigin = '';\nend;\nend;\nend;\nelse do;number = .;\norigin = '';\nend;\nend;\n;\n\n      rule_end:  /* label for rule RETURN action */\n    end;\n\n  endpackage;",
      "language": "DS2"
    }
  ]
}